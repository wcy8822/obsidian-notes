---
vc-id: 07260374-3f0c-445a-9d9e-b1ca7e76d46c
创建/更新日期: 2025-09-28
---

202509281750
# 数据清洗程序测试框架与样本设计方法论（抽象版）

## 一、核心约束原则（框架基础）

### 1. 不可变更域（保持系统一致性的基础）
- 数据源结构：原始数据的字段定义、数据类型、关联关系（确保样本与生产数据结构一致）
- 核心业务规则：清洗字典的映射逻辑、标准化转换规则、业务校验阈值
- 输出规格：最终结果的字段集合、格式规范、存储方式

### 2. 可调整域（允许优化的范围）
- 执行效率：数据加载方式、处理批次大小、内存管理策略
- 过程监控：日志粒度、进度反馈形式、中间结果存储位置
- 异常处理：错误捕获范围、异常标记方式、重试机制

### 3. 协同基准规则
- 所有修改需标注"变更点-原因-影响范围"
- 迭代过程需保持"可回溯性"（每个版本可复现测试结果）
- 功能调整必须同步更新对应测试用例
- 阶段切换需满足预设的准入/准出条件

## 二、测试样本设计方法论（ABC分类框架）

### 样本设计核心原则
- 结构一致性：样本数据的字段组成、类型、关联关系与原始数据源完全一致
- 场景覆盖率：覆盖原始数据中90%以上的业务特征与数据模式
- 可验证性：每个样本需包含明确的预期结果（基于核心业务规则）

### A组样本：常规场景样本（基础功能验证）
- 定义：符合主流业务特征、无异常的标准数据集合
- 设计要求：
  - 占比：覆盖原始数据中80%以上的常规模式
  - 特征：字段完整、格式规范、符合核心业务规则的典型值
  - 数量：建议100-1000条（根据数据复杂度调整）
- 核心测试目标：验证基础清洗逻辑的正确性、常规场景的处理准确性

### B组样本：边缘场景样本（边界条件验证）
- 定义：包含非典型但合理业务场景的数据集合
- 设计要求：
  - 覆盖范围：原始数据中10%-15%的非标准但有效模式
  - 特征类型：
    - 格式变体（如合理缩写、符号修饰、多语言混写）
    - 业务变体（如特殊分类、历史遗留格式、跨界关联）
    - 规则边缘（处于多个清洗规则交叉区域的数据）
  - 数量：建议50-500条（覆盖所有边缘类型）
- 核心测试目标：验证规则的完整性、边界条件的处理逻辑

### C组样本：异常场景样本（容错能力验证）
- 定义：包含不符合规范、存在错误或缺失的数据集合
- 设计要求：
  - 覆盖范围：原始数据中可能出现的所有错误类型
  - 特征类型：
    - 数据错误（如格式错误、值异常、编码问题）
    - 结构缺陷（如字段缺失、关联断裂、重复数据）
    - 逻辑冲突（如与业务规则矛盾、自相矛盾的值）
  - 数量：建议20-200条（覆盖所有错误类型）
- 核心测试目标：验证程序的容错能力、错误识别与处理机制

## 三、测试执行流程（渐进式验证框架）

### 阶段1：小规模功能验证（入口：待测试代码）
1. **样本准备**：生成ABC三组样本，建立预期结果基准库
2. **执行约束**：
   - 启用详细日志模式（记录每条数据的完整处理链路）
   - 关闭批量优化机制（确保单条数据处理逻辑可追溯）
3. **准出条件**：
   - A组样本处理准确率100%
   - B组样本处理准确率≥90%（剩余10%需明确原因）
   - C组样本无程序崩溃，错误识别率100%
4. **回溯机制**：
   - 未达标项需定位至"规则缺陷/代码逻辑/样本设计"
   - 修复后仅重测失败样本（保留成功样本测试记录）
   - 记录版本变更日志（含修改点与影响评估）

### 阶段2：中规模性能验证（入口：阶段1达标）
1. **样本准备**：随机抽取原始数据的5%-10%（保持原始分布特征）
2. **执行约束**：
   - 启用性能监控（记录处理耗时、资源占用、吞吐量）
   - 启用批量处理机制（模拟生产环境配置）
3. **准出条件**：
   - 功能指标：与阶段1结果一致性≥95%
   - 性能指标：处理效率、资源占用符合预设阈值
   - 稳定性：连续3次执行结果一致（无随机错误）

### 阶段3：全量生产验证（入口：阶段2达标）
1. **预处理**：
   - 原始数据备份与只读保护
   - 环境一致性检查（与生产环境配置对齐）
   - 断点机制启用（设置关键检查点）
2. **分阶段执行**：
   - 第一阶段（20%数据）：验证规则一致性
   - 第二阶段（50%数据）：验证性能稳定性
   - 第三阶段（100%数据）：验证整体结果完整性
3. **准出条件**：
   - 全量结果与样本测试的规则一致性≥99%
   - 性能指标全程稳定（无明显衰减或泄漏）
   - 异常数据处理符合预设机制（无遗漏）

## 四、AI协同管理规范

### 1. 信息同步模板
```
当前阶段：[阶段X.步骤Y]
状态描述：[已完成事项/当前结果/未达标项]
核心依据：[数据指标/日志片段/样本测试结果]
下一步需求：[具体任务+约束条件]
历史关联：[相关版本/之前结论/需延续的逻辑]
```

### 2. 样本生成约束指令
```
请基于以下数据源特征生成[X组]测试样本：
1. 数据源结构：[字段定义+类型+关联关系]
2. 核心业务特征：[常规模式/边缘模式/错误模式的抽象描述]
3. 生成约束：
   - 数量：[具体条数]
   - 场景覆盖：[需包含的特征列表]
   - 禁止项：[不允许出现的特征]
4. 输出要求：样本数据+预期结果+场景标签
```

### 3. 问题修复沟通模板
```
问题定位：在[样本/阶段]中，[数据特征]触发[错误现象]
预期标准：[基于业务规则的正确结果/行为]
当前偏差：[实际结果与预期的差异]
约束条件：修改时不得变更[不可变更域内容]，可调整[可调整域内容]
交付要求：修改方案+影响评估+回归测试范围
```

## 五、验证机制与文档管理

### 1. 验证指标体系
- 功能维度：准确率（符合预期结果的比例）、覆盖率（被正确识别的场景比例）
- 性能维度：处理效率（单位数据耗时）、资源占用（内存/CPU峰值）、稳定性（无故障运行时长）
- 过程维度：可追溯性（每步结果可溯源）、可解释性（处理逻辑可解析）

### 2. 文档管理要求
- 版本控制表：记录代码版本、对应测试样本、核心指标
- 样本库：保存所有测试样本及预期结果（按ABC分类）
- 问题清单：汇总所有发现的问题、修复方案、验证结果
- 决策记录：关键节点的判断依据、调整理由、共识结论

该框架通过抽象化业务场景、明确样本设计逻辑与测试流程，可适配各类数据清洗场景。核心价值在于：通过ABC样本分类实现全面覆盖，通过渐进式阶段验证控制风险，通过明确的约束规则确保AI协同过程不偏离主线目标。

[^1]: tim
