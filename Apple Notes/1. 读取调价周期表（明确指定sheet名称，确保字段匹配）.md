def load_cycle_data(cycle_path):
    """读取并预处理调价周期表，确保字段正确"""
    cycle_df = pd.read_excel(cycle_path, sheet_name='调价周期')  # 强制读取sheet名为“调价周期”
    
    # 2. 检查关键字段是否存在
    required_columns = ['日期', '上一个调价日', '下一个调价日', '是否工作日']
    missing_cols = [col for col in required_columns if col not in cycle_df.columns]
    if missing_cols:
        raise ValueError(f"调价周期表缺少必要字段：{missing_cols}，请检查表格格式")
    
    # 3. 转换日期格式
    cycle_df['日期'] = pd.to_datetime(cycle_df['日期'])
    cycle_df['上一个调价日'] = pd.to_datetime(cycle_df['上一个调价日'])
    cycle_df['下一个调价日'] = pd.to_datetime(cycle_df['下一个调价日'])
    
    # 4. 处理“是否工作日”字段（兼容布尔值True/False或整数1/0）
    if cycle_df['是否工作日'].dtype in [np.int64, np.float64]:
        # 若字段是整数（1=工作日，0=非工作日），转换为布尔值
        cycle_df['是否工作日'] = cycle_df['是否工作日'] == 1
        print("调价周期表：已将整数型'是否工作日'转换为布尔值（1→True，0→False）")
    
    return cycle_df

# 5. 在主程序中调用（替换原读取周期表的代码）
if __name__ == "__main__":
    # ...（其他代码不变）
    # 读取调价周期表（使用修复后的函数）
    cycle_df = load_cycle_data(CYCLE_DATA_PATH)  # 替换原 cycle_df = pd.read_excel(...) 一行
    # ...（后续代码不变）




| <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>日期</b></span></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>城市</b></span></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>油品类型</b></span></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>综合变化率</b></span></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>预计调价状态</b></span></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>预测准确率</b></span></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>预测调价幅度</b></span><b>-升</b></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>发改委价格</b></span></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>上一个调价日</b></span></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>下一个调价日</b></span></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>预测调价幅度</b></span><b>-吨</b></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>时间周期</b></span></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>系数</b></span><b>/吨</b></p> | <p style="text-align:center;margin:0"><span style="font-family:.PingFangUITextSC-Bold;"><b>系数</b></span><b>/升</b></p> |
| -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- |