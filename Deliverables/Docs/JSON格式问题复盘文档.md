# JSON格式问题复盘文档及AI生成提示规范


## 一、问题复盘：为什么AI生成的JSON难以解析？

### 1. 问题现象
- 解析时频繁出现`JSONDecodeError`，提示“Expecting property name enclosed in double quotes”“Expecting ',' delimiter”等错误
- 核心数据被多层嵌套（列表→text字段→```json标记→内部JSON），增加解析复杂度
- 肉眼可见的格式“正常”，但程序始终无法识别，最终通过纯文本匹配才提取到数据


### 2. 根因分析（AI生成JSON的典型缺陷）
| 问题类型                | 具体表现                                  | 为什么导致解析失败                          |
|-------------------------|-------------------------------------------|---------------------------------------------|
| 引号混用                | 外层用单引号`'`，内层用双引号`"`          | 标准JSON要求**所有字符串必须用双引号**       |
| 中文标点污染            | 使用中文逗号`，`、中文引号`“”`            | JSON解析器只认英文标点`.,""`                 |
| 多余格式标记            | 包含```json```等代码块标记                | 这些标记不属于JSON语法，会破坏结构完整性      |
| 嵌套层级混乱            | 无必要的多层嵌套（列表→对象→text→JSON）  | 增加解析路径复杂度，容易出现层级定位错误      |
| 隐藏字符干扰            | 包含非标准换行符、零宽度空格等            | 解析器在起始位置遇到无效字符，直接判定格式错误|


### 3. 解决历程
1. **标准解析阶段**：尝试用`json.loads()`直接解析，因格式错误失败
2. **容错优化阶段**：添加单引号转双引号、去除多余标记等逻辑，部分问题解决但仍有隐藏字符干扰
3. **暴力提取阶段**：放弃完整解析，通过正则匹配`"字段名": 值`模式直接提取，最终成功


### 4. 关键经验
- AI生成的JSON可能“看起来正确”，但存在大量隐性格式问题
- 解析前务必先做“格式净化”（替换标点、去除标记、清理隐藏字符）
- 当多层嵌套解析困难时，可直接通过“字段名正则匹配”提取数据，绕过结构问题


## 二、给AI的JSON生成提示规范（避免重复踩坑）

请按照以下规范生成JSON数据，确保程序可解析：

1. **严格使用双引号**  
   - 所有字符串（包括属性名和值）必须用英文双引号`"`，禁止使用单引号`'`或中文引号`“”`  
   - 错误示例：`{'name': '油站'}` 正确示例：`{"name": "油站"}`

2. **只保留纯JSON内容**  
   - 禁止包含```json```、```python```等代码块标记  
   - 禁止添加注释、说明文字（如“以下是JSON数据”）  
   - 错误示例：```json {"key": "value"} ``` 正确示例：`{"key": "value"}`

3. **使用英文标点**  
   - 逗号、冒号、括号等必须用英文符号，禁止中文标点`，：（）`  
   - 错误示例：`{"city"："北京"，"price"：6.61}` 正确示例：`{"city":"北京","price":6.61}`

4. **简化嵌套结构**  
   - 避免无意义的多层嵌套（如列表套对象再套text字段）  
   - 核心数据直接放在顶层或明确的层级（如`{"油站列表": [{"名称": "..."}]}`）

5. **清除隐藏字符**  
   - 避免使用非标准换行符、零宽度空格等特殊字符  
   - 字符串中如需换行，使用标准转义符`\n`

6. **生成后自检**  
   - 提供的JSON需能通过在线校验工具（如json.cn）验证  
   - 若包含中文，确保使用UTF-8编码且无BOM头


按照以上规范生成的JSON，可直接被`json.loads()`解析，避免99%的格式问题。如需记录生成过程，建议将“过程说明”和“纯JSON数据”分开存放，而非嵌套在JSON中。


---
要让AI生成符合标准的JSON数据，核心是通过**精准提示+约束条件+示例引导**，明确告诉AI“必须遵守的规则”和“禁止出现的错误”。以下是经过验证的有效方法，结合你的场景整理如下：


### 一、给AI的“强制规范提示”（直接复制使用）
在要求AI生成JSON时，先明确告知以下规则，用加粗或序号强调：

```
请生成严格符合JSON标准的结构化数据，必须遵守以下规则：

1. 引号规范：
   - 所有属性名（如"城市"）和字符串值（如"北京"）必须使用英文双引号`"`，绝对禁止使用单引号`'`、中文引号`“”`
   - 错误示例：`{'城市': '北京'}` 或 `{"城市": '北京'}`  
   - 正确示例：`{"城市": "北京"}`

2. 标点规范：
   - 所有逗号、冒号、括号必须使用英文符号（`, : { } [ ]`），禁止中文标点（`，：（）`）
   - 数组/对象最后一个元素后**禁止多余逗号**（如`[1,2,3,]`是错误的）

3. 内容纯净：
   - 只返回纯JSON数据，禁止包含任何额外文本（如“以下是JSON”“```json”“解析说明”等）
   - 禁止在JSON中添加注释（JSON标准不支持注释）

4. 结构简洁：
   - 避免无意义的多层嵌套（如无需用`[{"text": "..."}]`包裹核心JSON）
   - 核心数据直接放在明确的键下（如用`{"油站列表": [...]}`直接包含数据）

5. 编码兼容：
   - 包含中文时，确保用UTF-8编码（无需转义，直接写中文）
   - 禁止包含零宽度空格、非标准换行符等隐藏字符

请生成后自检：确保能通过在线JSON校验工具（如json.cn）验证，无任何语法错误。
```


### 二、提供“正确示例”引导AI理解标准
AI对“示例”的理解远胜于抽象规则。在提示中加入1-2个符合标准的JSON示例，让AI明确“正确格式长什么样”。

例如，针对你的油站数据场景，可提供：

```
请参考以下正确格式生成JSON（仅作示例，内容需替换为实际数据）：

{
  "油站总数": 2,
  "油站列表": [
    {
      "日期": "2025-09-11",
      "城市": "北京",
      "油站名称": "强安加油站",
      "地址": "健德门桥西南角",
      "距离": "3.47km",
      "优惠价格": "6.61",
      "油站价": "7.11",
      "营销策略": "加200省11.39",
      "优惠信息": "未知",
      "是否新站": "否"
    },
    {
      "日期": "2025-09-11",
      "城市": "北京",
      "油站名称": "北沙滩加油站",
      "地址": "北沙滩2号",
      "距离": "3.98km",
      "优惠价格": "6.72",
      "油站价": "7.11",
      "营销策略": "加200省9.21",
      "优惠信息": "未知",
      "是否新站": "否"
    }
  ]
}
```


### 三、生成后“强制校验”的提示
即使AI声称“已符合标准”，也可在提示中要求它“自我验证”，进一步降低错误概率：

```
生成后请执行以下检查并反馈：
1. 用json.cn工具验证是否存在语法错误
2. 检查是否有单引号、中文标点、多余逗号
3. 确认没有非JSON内容（如代码块标记）
若存在错误，请修正后再返回最终JSON。
```


### 四、本质原因：为什么AI容易生成“不标准JSON”？
AI生成JSON时，常因以下原因出错，理解后可针对性规避：
1. **“人类化表达”惯性**：AI可能模仿人类书写时的“随意性”（如混合引号、加注释），忽略JSON的严格语法
2. **“上下文污染”**：如果你的提示中包含非标准格式（如用单引号的示例），AI会模仿错误格式
3. **“冗余信息”倾向**：AI可能主动添加解释性文本（如```json标记），误以为能让内容更清晰


### 总结
让AI生成标准JSON的核心是：**“规则要具体到‘可执行’，示例要精准到‘可模仿’，约束要严格到‘必遵守’”**。按照上述方法，95%以上的格式问题都能避免，无需再经历“解析-报错-反复修改”的痛苦流程。