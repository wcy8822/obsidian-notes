#代码 #知识
要解决“代码难管理、过段时间忘用途”的问题，核心是建立 **“结构化分类+文档化记录+简化使用”** 的管理方案，不需要复杂工具，用基础的文件夹分类和文档就能实现。以下是具体可落地的方案，从“文件分类→文档记录→使用追溯”全流程覆盖：


## 一、第一步：文件结构化分类（核心是“按用途分层”，一眼能找到）
先建立清晰的文件夹结构，把“过程代码”“最终代码”“配置”“文档”完全分开，避免混在一起。建议的目录结构如下（可直接在你的`brand-ocr`项目根目录下创建）：
```
brand-ocr/
├─ 01_final_code/          # 【最终可用代码】（仅放能直接运行的最终脚本，最核心）
│  ├─ oil_station_processor.py  # 最终的油站自动化处理脚本（唯一需要日常用的）
│  ├─ requirements.txt     # 依赖包清单（一键安装所有依赖）
│  └─ config/              # 配置文件（单独放，避免改代码）
│     └─ api_key.ini       # API密钥配置（不用硬编码在代码里）
├─ 02_process_code/        # 【过程测试代码】（放之前的测试脚本，供参考）
│  ├─ test_1_single_image.py  # 测试单张图片处理（早期脚本）
│  ├─ test_2_batch_no_excel.py  # 测试批量处理（无Excel导出）
│  └─ test_3_accuracy_calc.py  # 测试准确率计算逻辑（单独验证用）
├─ 03_output/              # 【处理结果】（程序运行后自动生成，不用手动管）
│  ├─ processed/           # 分类后的图片（成功/失败/待确认）
│  ├─ results/             # 最终结果CSV
│  ├─ to_confirm/          # 待确认结果CSV
│  └─ intermediate/        # 中间日志和JSON
├─ 04_docs/                # 【文档】（放所有说明文档，关键！）
│  ├─ 01_requirement_doc.md  # 需求文档（之前我们确认的需求，方便回忆目标）
│  ├─ 02_user_manual.md    # 使用手册（怎么运行、怎么查结果， step by step）
│  └─ 03_version_log.md    # 版本日志（记录代码迭代，知道每个版本改了啥）
└─ 05_input/               # 【待处理图片】（仅放要处理的图片，可建子文件夹）
   ├─ 20250915_北京/       # 按“日期+城市”建子文件夹，方便管理
   │  └─ 油站1.jpg
   └─ 20250916_上海/
      └─ 油站2.jpg
```

### 分类逻辑说明：
- **核心文件（01_final_code）**：只留最终能用的脚本，其他过程代码放一边，避免每次找代码都要筛选；  
- **过程代码（02_process_code）**：按“功能+时间”命名，每个文件开头加简短注释（说明它是测试什么的），比如`test_1_single_image.py`开头加`# 功能：测试单张图片的AI调用和结果解析，无批量处理功能`；  
- **结果（03_output）**：程序自动生成，不用手动整理，按之前的逻辑分类；  
- **文档（04_docs）**：这是“记忆锚点”，过N天忘了，看这里就够了；  
- **输入（05_input）**：按“日期+城市”建子文件夹，图片来源清晰，后续查原始图片也方便。


## 二、第二步：文档化记录（关键是“写清楚3件事：是什么、怎么用、改了啥”）
文档不用复杂，用Markdown格式（`.md`），记事本就能编辑，核心是3个文档：


### 1. 核心文档：04_docs/02_user_manual.md（使用手册，最常用）
作用：过段时间想运行代码，看这篇就够了，不用看代码逻辑。内容按“步骤化”写，比如：

```markdown
# 油站图片处理脚本使用手册

## 一、脚本用途
批量处理油站图片，自动提取油站信息（城市、名称、价格等），输出结构化CSV，支持追溯图片来源。

## 二、环境准备（第一次用必看）
1. 安装Python：要求Python 3.8+，下载地址：https://www.python.org/downloads/
2. 安装依赖包：
   打开命令行，进入`01_final_code`文件夹，运行：
   ```cmd
   pip install -r requirements.txt
   ```
3. 配置API密钥：
   打开`01_final_code/config/api_key.ini`，填写：
   ```ini
   [TONGYI]
   api_key = 你的通义千问API密钥
   ```

## 三、使用步骤（每次用都看）
1. 放图片：把要处理的图片放进`05_input`文件夹（可建子文件夹，比如“20250915_北京”）；
2. 运行脚本：
   打开命令行，进入`01_final_code`文件夹，运行：
   ```cmd
   python oil_station_processor.py
   ```
3. 看结果：
   - 成功的结果：`03_output/results/final_results.csv`（直接用）；
   - 待确认的结果：`03_output/to_confirm/to_confirm_summary.csv`（需人工改）；
   - 处理后的图片：`03_output/processed/`（按成功/失败/待确认分类）；
   - 日志：`03_output/intermediate/processing_log.csv`（查问题用）。

## 四、常见问题（遇到报错看）
1. 报错“API密钥无效”：检查`api_key.ini`里的密钥是否正确，是否过期；
2. 报错“找不到图片”：确认图片放在`05_input`文件夹，且格式是.jpg/.png；
3. 结果里“城市”是“未知”：检查图片是否有城市信息，或在提示词里补充“优先提取图片中的城市名”。

## 五、文件位置速查
| 用途                | 路径                                  |
|---------------------|---------------------------------------|
| 最终脚本            | 01_final_code/oil_station_processor.py |
| 依赖包清单          | 01_final_code/requirements.txt        |
| API密钥配置         | 01_final_code/config/api_key.ini      |
| 待处理图片          | 05_input/                             |
| 成功结果            | 03_output/results/final_results.csv   |
```
```


### 2. 辅助文档1：04_docs/03_version_log.md（版本日志，记迭代）
作用：知道代码什么时候改了，改了什么，避免用错旧版本。内容按“版本+日期+更新内容”记录：

```markdown
# 代码版本日志
## V1.0（2025-09-15）
- 功能：实现单张图片处理，提取油站信息，输出JSON；
- 问题：不支持批量处理，没有Excel导出；
- 脚本位置：02_process_code/test_1_single_image.py。

## V2.0（2025-09-16）
- 更新：支持批量处理，新增Excel导出；
- 问题：不支持穿透子文件夹读图片，准确率计算逻辑简单；
- 脚本位置：02_process_code/test_2_batch_no_excel.py。

## V3.0（2025-09-17，最终版）
- 更新：
  1. 支持穿透子文件夹读图片；
  2. 优化准确率计算（字段完整性+格式+逻辑三维度）；
  3. 图片按结果分类移动，支持追溯；
  4. 新增配置文件，不用硬编码API密钥；
- 脚本位置：01_final_code/oil_station_processor.py；
- 备注：此版本为最终可用版本，后续不再修改。
```


### 3. 辅助文档2：04_docs/01_requirement_doc.md（需求文档，记目标）
作用：过段时间忘了“当初为什么写这个代码”，看这篇回忆需求。直接用我们之前确认的需求文档，复制进去即可，方便对照“需求”和“代码功能”是否匹配。


## 三、第三步：简化日常使用（核心是“减少记忆成本”）
1. **依赖包固化**：在`01_final_code`里放`requirements.txt`，记录所有需要的包和版本，避免过段时间忘了装什么包。内容如下：
   ```txt
   dashscope==1.14.0  # 通义千问SDK
   pandas==2.2.2       # 处理CSV/Excel
   openpyxl==3.1.2     # 读写Excel
   python-dotenv==1.0.1 # 可选，用于读取环境变量（如果不用ini文件）
   ```

2. **配置文件分离**：把API密钥、文件夹路径等“容易变的参数”放进`config/api_key.ini`，不用改代码。比如代码里读取配置的逻辑（可加在`init_environment`函数里）：
   ```python
   import configparser
   # 读取API密钥
   config = configparser.ConfigParser()
   config.read("config/api_key.ini")
   dashscope.api_key = config.get("TONGYI", "api_key")
   ```

3. **快捷运行脚本（可选）**：如果是Windows，可在`01_final_code`里建一个`运行脚本.bat`文件，双击就能运行，不用每次输命令。内容：
   ```bat
   @echo off
   echo 开始处理油站图片...
   python oil_station_processor.py
   echo 处理完成！按任意键退出...
   pause
   ```


## 四、进阶方案（如果后续代码越来越多）
如果以后需要管理更多代码，或多人协作，可加一步 **“版本控制”**，用Git（简单版，不用复杂操作）：
1. 安装Git：https://git-scm.com/downloads；
2. 在`brand-ocr`根目录下右键“Git Bash Here”，初始化仓库：
   ```bash
   git init
   ```
3. 每次改代码后，记录变更（比如改了`oil_station_processor.py`）：
   ```bash
   git add 01_final_code/oil_station_processor.py
   git commit -m "20250917：修复准确率计算bug"
   ```
4. 过段时间想回退到旧版本，或看历史修改，用`git log`查记录，`git checkout 版本号`回退。


## 总结：核心是“让每个文件有‘身份’，每个操作有‘步骤’”
- **分类**：把“最终用的”“测试用的”“结果”“文档”分开，找的时候不迷路；  
- **文档**：用3个核心文档（使用手册、版本日志、需求文档）当“记忆锚点”，忘了就看；  
- **简化**：固化依赖、分离配置、做快捷脚本，减少日常使用的记忆成本。  

按这个方案，过N天再看，只要打开`04_docs/02_user_manual.md`，就能知道“这代码是干嘛的、怎么运行、结果在哪”，完全不用记代码细节。