# 《回填模板 v1.0》（STD 对齐版 · 可直接使用）

> 版本：v1.0 · 适用里程碑：**930 上线 P0=13 标签**\
> 适用对象：区域同学（S2）、商户运营（S3）、情报采集（S4）\
> 统一口径：**RAW 主键 **``**；值槽位三选一且互斥；仅表格字段**

---

## 0. 使用前须知

- 你将填写 **CSV**，交由 DE 写入 Hive 的 RAW 分区表（或由工具直写 RAW 表）。
- **必须具备 **``（由官方画像 S1 解析而来），否则不要提交。
- ``** 必须来自字典视图 **``（由 DE/数据平台每日导出清单给你下拉选择）。
- **时间口径**：`as_of_date=事实发生自然日`（通常 D-1）；`report_time=录入时间`（UTC+8）。
- **布尔取值**：`1=是，0=否，99=未知`；**枚举**填 **code**（非中文名）。

---

## 1. 三类模板（列头可直接复制）

### 1.1 区域反馈模板（S2 → `raw_region_tag`）

```csv
store_id,as_of_date,tag_code,target_value_bool,target_value_number,target_value_string,report_time,reporter,source_channel,batch_id,reason,ext_col_1,ext_col_2
```

**字段说明**：

- `source_channel` 建议取 `app/form/excel`；`reason` 可简单描述依据（如“现场照片已归档”——注意此处不上传图片）。

---

### 1.2 商户运营订正模板（S3 → `raw_ops_tag`）

```csv
store_id,as_of_date,tag_code,target_value_bool,target_value_number,target_value_string,ttl_days,reason,report_time,reporter,source_channel,batch_id,ext_col_1
```

**字段说明**：

- `ttl_days` **必填且 >0**；订正会以 **Locked** 方式生效，过期自动降级。
- `reason` 简要写明订正依据（合同附件、官方回函等）。

---

### 1.3 情报反馈模板（S4 → `raw_intel_tag`）

```csv
store_id,as_of_date,tag_code,target_value_bool,target_value_number,target_value_string,report_time,reporter,source_channel,batch_id,reason,ext_col_1
```

**字段说明**：

- 情报为**侧证**，通常权重较低（由规则配置）。请在 `reason` 中标注来源渠道（网站名、合作方、批次等）。

---

## 2. 如何选择 `tag_code`（P0=13 示例）

- 每日由 DE 导出 `vw_tag_spec_current` 供你下拉选择，包含：`tag_code, tag_name, value_type, enum_values`。
- **示例（非完整清单，实际以导出为准）**：
  - `service.carwash_exists`（BOOL）：是否有洗车服务 → `target_value_bool ∈ {1,0,99}`
  - `open.24h`（BOOL）：是否 24 小时营业 → `target_value_bool`
  - `open.hours`（STRING）：营业时段 → `target_value_string='HHMM-HHMM'`（如 `0800-2200`）
  - `service.store_type`（ENUM/STRING）：便利店类型 → `target_value_string ∈ enum_values`（如 `c_store/kiosk/...`）
  - `brand.display_text`（STRING）：外显品牌文案 → `target_value_string`
  - `parking.exists`（BOOL）：是否有停车位 → `target_value_bool`

> **不要手写新 **``。如字典无该项，请联系产品/数据治理登记后再填报。

---

## 3. 填写校验清单（提交前务必自查）

-

---

## 4. 规范示例（可照抄）

### S2：区域反馈（有洗车）

```csv
store_id,as_of_date,tag_code,target_value_bool,target_value_number,target_value_string,report_time,reporter,source_channel,batch_id,reason
100023,2025-09-02,service.carwash_exists,1,,,2025-09-02 15:30:00,zhangsan,app,20250902A,门店口述+现场核对
```

### S3：订正（24 小时营业，TTL=90）

```csv
store_id,as_of_date,tag_code,target_value_bool,target_value_number,target_value_string,ttl_days,reason,report_time,reporter
100023,2025-09-02,open.24h,1,,,90,合同附件确认,2025-09-02 16:00:00,lisi
```

### S4：情报（便利店类型=连锁便利店 code）

```csv
store_id,as_of_date,tag_code,target_value_bool,target_value_number,target_value_string,report_time,reporter
100023,2025-09-02,service.store_type,,,c_store,2025-09-02 11:00:00,external_sync
```

---

## 5. 常见错误与修复

| 场景            | 错误示例                                                | 诊断     | 修复                                   |
| ------------- | --------------------------------------------------- | ------ | ------------------------------------ |
| 双槽位同时填        | `target_value_bool=1` 且 `target_value_string='yes'` | 违反互斥   | 仅保留与 `value_type` 匹配的一项              |
| tag\_code 不存在 | `service.parking`                                   | 未登记    | 从字典清单选择合法项或申请新增                      |
| 类型不匹配         | `open.hours` 写了 `target_value_bool=1`               | 类型错配   | 改填 `target_value_string='0800-2200'` |
| 缺少 store\_id  | `store_id=NULL`                                     | 主键缺失   | 先用官方画像解析出 `store_id` 再提交             |
| 订正缺少 TTL      | S3 未填 `ttl_days`                                    | 订正无有效期 | 填写 `ttl_days>0`（默认建议 90/180）         |

---

## 6. 提交流程（面向业务/区域）

1. 获取当日 `tag_code` 下拉清单（DE 每日导出或提供在线字典）。
2. 按模板准备 CSV，完成第 3 节自查。
3. 通过工具/流程写入 Hive 对应 RAW 表当日分区（或将 CSV 交由 DE 导入）。
4. 用提供的 Hive SQL 片段自查到数与校验（行数/去重/互斥/类型）。
5. 如需订正，务必提供 `ttl_days` 与 `reason`。

---

## 7. FAQ

- **一次能填多个标签吗？** 可以；同一 `store_id+as_of_date` 可多行、每行一个 `tag_code`。
- **能填历史日期吗？** 可以；`as_of_date` 写实际日期即可。
- **枚举的 code 看哪里？** 看下拉字典中的 `enum_values` 列（或咨询 DE 提供的字典文档）。
- **发现字典缺项怎么办？** 提需求给产品/治理，新增后再填报；不要自造 `tag_code`。

