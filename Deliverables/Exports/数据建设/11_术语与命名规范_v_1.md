# 《术语与命名规范 v1.0》

> 版本：v1.0 · 适用里程碑：**930 上线 P0=13 标签**  
> 目的：统一口径、减少歧义，保证跨部门协作时“同一词只有一个含义”。

---

## 1. 角色与对象
- **业务**：提出标签需求、组织采集/订正、参与 QA。  
- **DE（数据工程）**：接收数据→标准化→融合→发布，维护表与作业。  
- **DS（数据科学）**：抽样评估、阈值建议、漂移分析与验收。  
- **治理/产品**：`tag_spec/rule_config/quality_policy` 变更管理与发版。

---

## 2. 关键术语
- **标签（Tag）**：业务可读、对外使用的三层结构项（本期以**三级标签**为最小单位）。
- **标签字典（Tag Spec/Dictionary）**：`tag_spec` 与其视图 `vw_tag_spec_current`；包含 `tag_id/tag_code/tag_name/value_type/class(A|B)/enum_set/status` 等。
- **信号（Signal）**：用以计算标签的中间事实，落在 **INPUT Tall**；键为 `signal_key`（通常与 `tag_code` 等名或近名）。
- **证据（Evidence/Trace）**：支撑标签值的来源/探测器/打分过程；以 `trace_id` 指向 `tag_trace` 存储。
- **证据阶梯（Evidence State）**：`Unknown < Candidate < Inferred < Verified < Locked`。
- **订正（Fix）**：商户运营对标签的**人工修正**；优先级最高，`Locked + TTL` 生效。
- **A/B 类**：A=线下上翻（多源融合+证据阶梯）；B=纯线上契约（100% 可重算）。
- **SCD2（缓慢变化维二型）**：用 `effective_from/effective_to/is_current` 表示历史版本与当前版本。

---

## 3. 表与视图（短名规范）
- **RAW（Hive）**：`raw_region_tag` / `raw_ops_tag` / `raw_intel_tag`（分区 `ingest_date`）。
- **STD**：`std_region_tag` / `std_ops_tag` / `std_intel_tag`（含 `std_ruleset`）。
- **INPUT Tall**：`tag_input`（信号事实；键=`as_of_date, source, store_id, signal_key`）。
- **OUTPUT Tall**：`tag_value_fact`（标签真相层；键=`station_gid, as_of_date, tag_id`）。
- **Trace**：`tag_trace(trace_id, trace_json, created_at, size_bytes)`。
- **Hot 宽层**：`tag_wide_daily`（白名单透视）· `tag_wide_hot_list`（白名单）· `tag_wide_daily_compat`（兼容）。
- **治理**：`tag_spec` · `vw_tag_spec_current` · `tag_signal_map` · `tag_change_log` · `tag_backward_compat`。

---

## 4. 命名规则
### 4.1 列名
- 统一小写 + 下划线：`store_id, as_of_date, tag_code`。  
- 布尔：`*_exists`/`*_enabled`；取值 `1/0/99`。  
- 七件套：`source/conf/ver/class/evidence_state/trace_id`。  
- 值槽位：`value_string/value_number/value_bool`（Tall）或 `${col_prefix}_value_*`（Wide）。

### 4.2 标签/信号编码
- **可读 + 域前缀**：`domain.subdomain.item`（如 `service.carwash_exists`）。  
- **稳定性优先**：`tag_code` 一经发布尽量不改名；需要改名走 `tag_change_log` 与 `tag_backward_compat`。

### 4.3 时间字段
- `as_of_date`（DATE，自然日） vs `report_time`（TIMESTAMP，UTC+8）；`updated_at` 为技术时间戳。

### 4.4 枚举
- 存 **code**，展示时 join 中文；字典同步由治理负责。

---

## 5. 质量与 SLA 术语
- **Acc（准确率）**、**Cov（覆盖率）**、**Stable（稳定性）**、**Fresh（新鲜度）**：详见《质量监控与验收方案》。
- **Kappa（双人一致性）**：≥0.8 通过；用于抽样标注一致性评估。

---

## 6. 协作用语（温和口径）
- 用“**承接/配合/协作**”替代“全责/必须/必须改”。  
- 用“**到数/产出/发布**”替代“成功/失败”等二元语。  
- 用“**暂缓发布/灰度/回放/回滚**”描述异常处理与定位策略。

---

## 7. 版本与发版
- 采用 **SemVer**：`MAJOR.MINOR.PATCH`；规则/字典/热表白名单变更需发版并记录。  
- 发布点记录：`tag_release(release_id, date, scope, type={Normal|Replay|Rollback}, operator, note)`。

---

## 8. FAQ
- **Q：`tag_code` 与 `signal_key` 有何区别？** 前者是标签编码（治理口径），后者是计算用的信号键，通常同名或近名，由 `tag_signal_map` 维护一对一映射。  
- **Q：为何布尔用 99 表示未知？** 便于与 0 区分并统计“信息缺失/不适用”的比例。  
- **Q：为何强推 Tall？** 统一行式事实利于扩展与回放；宽层只服务热点消费并受白名单控制。

