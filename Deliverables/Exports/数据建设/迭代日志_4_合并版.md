# 迭代日志 4 · 合并版

---

## 🚀 启动 Prompt（沿用共识）
- **目标**：930 上线 P0=13；SLA：D+1 ≤ 11:00；质量闸门：Acc/Cov≥90、Stable≤5%、Fresh=T+1。  
- **四源**：S1（官方）/ S2（区域）/ S3（运营订正·Locked+TTL）/ S4（情报侧证）。  
- **三段式**：RAW → STD → INPUT Tall → OUTPUT Tall（tag_value_fact+七件套+SCD2；trace 外置）。  
- **交付口径**：业务交 CSV，DE 承接入库。  
- **订正优先**：S3 命中即 Locked，TTL 到期降级。  

---

## 📝 本轮任务
- 确认直通脚本在本地运行的表现（brand_name、brand_level、carwash_type 等枚举能正确写入 S3）。
- 聚焦 **空值处理与 reject 规则**：确认三槽位互斥、空值丢弃、非法 code 拒收的口径。  
- 梳理 **治理十表与业务 CSV 的映射关系**，避免职责不清。  
- 输出更新后的《自动化工具包使用说明（小白版）》作为培训文档。  

---

## 📂 产出文档
### 继承（来自日志1/2/3）
- 《治理10表 · 业务交付CSV模板》  
- 《业务填表指南（P0·六张治理+四源RAW）》  
- 《RAW 执行 Checklist》  
- 《P0 直通版（validate_enum=ON）脚本+mapping 模板》  

### 新增（本轮迭代）
- 《自动化工具包使用说明（小白版）》：指导业务只写 CSV，不碰 JSON，明确目录结构、填表顺序、常见错误排查。  
- 品牌/等级/洗车等枚举的 **rejects.csv 样例**，用于校验 validate_enum 的执行效果。  

---

## 🔑 共识要点
- 品牌直通：源表 `brand_text` 已是 code，脚本 enum_passthrough → target_value_string。  
- 中文展示列（如 brand_text1、brand_level_code1）忽略，不入 RAW。  
- validate_enum=ON，非法 code → rejects.csv，reason=invalid_enum_code。  
- 三槽位互斥：行内必须恰好一个槽位非空，否则丢弃。  
- 空值不写 S3，不保留“主键+空”。  
- 主键冲突：保 conf 高/后行。  
- 布尔一律 1/0/99，true/false/是/否 → 自动映射。  

---

## 📌 下一步（930 前路径）
1. 按《小白版说明》组织一次培训，让业务同学可独立完成治理+RAW CSV 的交付。  
2. 用直通脚本跑 20250906 批次，检查 rejects.csv 中的非法枚举，补齐 tag_enum。  
3. DE 承接 CSV 入 RAW_DAILY 分区，跑 STD 校验 → INPUT → OUTPUT。  
4. 输出一份覆盖率/准确率的阶段报告，验证是否达成 85%/90% 里程碑。  
5. 930 前进行全链路演练，确保回滚/回放可行，最终写入 tag_release。  

---

## 🧭 方法论（日志产出 PROMPT）
- 结构：启动 Prompt → 本轮任务 → 产出文档 → 共识要点 → 下一步 → 方法论。  
- 每版日志 = 上一版继承 + 本轮新增。  
- 风格：Markdown，简明可执行。  
- 目标：保证每次日志都能被快速回顾和执行，形成项目演进闭环。

