Task Completed

### 本地标签清洗工具使用手册

我们构建的这套工具，核心在于“配置”和“批次”。您未来的所有操作，都无需再修改代码，只需要管理数据文件和执行一个命令即可。

---

#### __第一步：准备新数据（创建新批次）__

您的所有新数据都应该放在 `data/raw/inbox/` 目录下。每一次清洗，都应该是一个独立的“批次 (Batch)”。

1. __确定一个批次名称 (Batch ID)__：这个名称将是您这次运行的唯一标识，建议使用日期或有意义的英文，例如 `20250922_weekly_data`。

2. __创建批次目录__：在 `data/raw/inbox/` 文件夹下，创建一个以上述名称命名&#x7684;__&#x65B0;文件夹__。

   - 例如：`data/raw/inbox/20250922_weekly_data/`

3. __放入数据文件__：将您的新数据（Excel 文件）放入刚刚创建的批次目录中，并根据数据源的类型，归类到对应的子文件夹（`s1`, `s2`, `s3`...）。这些源的定义来自于 `conf/sources.yaml`。

   - 例如，如果您有一个新的宽表数据源，应该放在 `s2` 文件夹下： `data/raw/inbox/20250922_weekly_data/s2/new_source_file.xlsx`
   - 如果您有一个新的长表数据源，应该放在 `s3` 文件夹下： `data/raw/inbox/20250922_weekly_data/s3/another_source.xlsx`

---

#### __第二步：运行清洗管道__

数据准备好后，您只需要打开终端，执行一个命令。

1. __打开终端__：确保您的终端位于当前项目根目录 (`tag_ct_clean`) 下。

2. __执行命令__：运行 `run.py` 脚本，并通过 `--batch_id` 参数指定您在第一步中创建的批次名称。

   ```bash
   python3 run.py --batch_id 20250922_0656
   ```

3. __命令示例__：

   - 如果我们第一步创建的批次是 `20250922_weekly_data`，那么您需要执行的命令就是：

     ```bash
     python3 run.py --batch_id 20250922_weekly_data
     ```

脚本会自动开始执行，并打印每一步的运行日志。

---

#### __第三步：查看结果__

管道运行结束后，所有的产出物都会被保存在 `runs/` 目录下的一个以本次运行ID命名的新文件夹中。

- __运行目录__：例如 `runs/20250922_weekly_data_20250922_093000/`
- __最终清洗结果__：在该目录下的 `brand_cleaned.csv` 文件中。
- __冲突池__：在该目录下的 `conflict_pool.csv` 文件中，包含了所有需要您人工关注的疑难数据及其证据。

---

#### __（高级）如何更新“规则”？__

如果您想更新清洗的规则或参考数据，只需修改 `conf/` 或 `data/ref/` 下对应的文件即可，无需改动代码：

- __品牌白名单/别名/权重__：修改 `data/ref/tag_enum.csv`
- __清洗规则（如后缀、停用词）__：修改 `conf/brand_cleaning_rules.yaml` 和 `conf/stop_words.yaml`
- __金标测试集__：修改 `data/ref/raw2_result.xlsx`

---

__总结：您的日常工作流就是 “准备数据 -> 运行命令 -> 查看结果” 这三步。__
