齐活儿，链路打通✅。给你一张“鸟瞰＋冲刺清单”，保证不跑偏、可马上动手。

# 总进度回顾（到哪了）

* 规范对齐｜三表与口径：**锁定**（两份 Canvas 都已确认）。
* 配置专册（TTL / 合并策略 / QA）：**锁定且校验 OK**。
* 骨架部署：**完成**（目录、Makefile、占位脚本、校验脚本）。
* 契约自检：**OK**（可一键 `make check-contracts`）。
* 示例数据：RAW1/RAW2 **已能产出**（示例版）。

# 还差的“功能块”（按节点）

1. **N1 RAW1（只采）**：示例能跑；需**接 sources.yaml 真列映射**，把你真实多源汇到 `sample_raw1.csv`。
2. **N2 RAW2（预清洗统一口径）**：示例能跑；需**按 tag\_spec 真正激活三槽**、补完 `evidence_state / reason / conf / ttl_days` 的全口径。
3. **N3 Tall（融合择优）**：待实现评分+tie-break+fallback 侧写；输出 `output/tall/tall_*.csv`。
4. **N4 Hot（宽层）**：按 `conf/fusion/hot_wide.yaml` 透视 13 列；联 `tag_enum` 取展示名（不落事实）。
5. **N5 QA 报告**：按 `conf/qa/metrics.yaml` 计算覆盖率/域外值/兜底率/新鲜度/变更率+反查。
6. **N6 快照/回放**：复制策略与三表到 `logs/snapshots/snap_*` 并支持参数回放。

# 现在的主线节奏（分批能跑）

* **批次 A（把“数据→RAW2”做实）**

  1. 你：把 10–50 行**真实样例**追加到 `data/raw/sample/sample_raw1.csv`（表头不变）。
  2. 我：升级 `raw1_build.py`（读 sources.yaml 真列映射）→ 你跑 `make raw1`。
  3. 我：升级 `raw2_clean.py` 为**全口径版**（三槽、状态、conf、ttl）→ 你跑 `make raw2` 出 `sample_raw2.csv`。
* **批次 B（RAW2→Tall/Hot/QA）**
  4\) 我：实现 `tall_merge.py`（评分+tie-break+fallback）→ `make tall`。
  5\) 我：实现 `hot_wide.py`（13 列透视+展示名 join）→ `make hot`。
  6\) 我：实现 `qa_report.py`（阈值告警+反向校验）→ `make qa`。
  7\) 你：`make snapshot` 固化一次“地标”用于回放。

# 即刻行动三步（今天就能做）

1. **追加真实样例**到 `data/raw/sample/sample_raw1.csv`（至少包含两个 `source`、3–5 条冲突、1–2 条枚举域外）。
2. **完善 `conf/mappings/sources.yaml`**：给 `s1/s2/...` 的高频 tag（`brand_name/open_24h/open_hours`）填上 `prefer_cols`。
3. **跑两条命令看契约**：

   ```bash
   make check-manifest
   make check-contracts
   ```

   都绿就代表“环境就绪、等填内容”。

# 验收与里程碑（DoD）

* **A 里程碑（RAW2 就绪）**：

  * RAW1/RAW2 表头契约 0 警告；
  * RAW2 覆盖 13 标签，三槽互斥，`evidence_state/ttl_days/conf` 合理；
  * 至少 1 个标签出现 `FALLBACK_APPLIED`，可追溯 `reason_text`。
* **B 里程碑（Tall/Hot/QA 全绿）**：

  * Tall 每 `store_id+tag_code` 当日仅 1 行；
  * Hot 13 列齐全，`open_24h` 与 `open_hours` 反查一致；
  * QA 四指标均低于 warn（或有告警但能解释）。

# 常用命令备忘

```bash
make touch-contracts       # 生成四张占位CSV（你已跑过）
make raw1                  # 生成/合并 RAW1
make raw2                  # 预清洗到 RAW2
make tall                  # 融合真相层
make hot                   # 宽表
make qa                    # 质量报告
make snapshot              # 快照回放基线
make full                  # 一键全链路
```

接下来，把你那 10–50 行真实样例丢进 RAW1，我就立刻把 N1/N2 的脚本升级到“可产真数据”的版本。我们沿着这个节奏，把系统一点点从“骨架”填成“能打的肌肉”。
